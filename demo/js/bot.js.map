{"version":3,"sources":["../../src/demo/js/bot.js"],"names":["window","metamind","Metamind","apiUrl","botImage","Math","random","toString","substr","$","document","on","e","sendMessage","text","click","show","disabled","attr","message","val","undefined","empty","append","scrollTop","scrollHeight","replaceLineBreaks","replace","data","hide","removeAttr","i","quickResponses","length","parsedResponse","html","response","type","find","dateAfterParam","dateAfter","dateAfterParts","split","moment","add","toDate","subtract","flatpickrInstance","_flatpickr","set","hint","ready","flatpickr","event","keyCode"],"mappings":"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","file":"bot.js","sourcesContent":["(() => {\n  'use strict';\n\n  window.metamind = new window.Metamind({apiUrl: 'https://api.metamind.fi/v1', 'story': 'lumme-electricity-order' });\n\n  var botImage = 'https://robohash.org/' + Math.random().toString(36).substr(2);\n  \n  $(document).on('click', '.quick-message-btn', function(e) {\n    sendMessage($(this).text());\n  });\n\n  $('.send-message-btn').click(function(e) {\n    sendMessage();\n  });\n  \n  function sendMessage(text) {\n    $('.bot-typing').show();\n    const disabled = $('.send-message-btn').attr('disabled');\n    const message = text || $('.user-text-input').val() || $('.user-date-input').val();\n\n    if (typeof disabled !== typeof undefined && disabled !== false) {\n      return;\n    }\n\n    $('.user-text-input').val('');\n    $('.send-message-btn').attr('disabled', 'disabled');\n    $('#botHintText').text('');\n    $('.quick-responses').empty();\n    $('.discussion-container').append(\n      `<div class=\"card user-response\">\n        <div class=\"card-body\">\n          <div class=\"media\">\n           <img class=\"mr-3 user-image\" src=\"gfx/user.png\">\n           <div class=\"media-body\">\n             <h5 class=\"mt-0\">Käyttäjä</h5>\n             ${message}\n           </div>\n          </div>\n        </div>\n      </div>`  \n    );\n    $('.discussion-container')[0].scrollTop = $('.discussion-container')[0].scrollHeight;\n    window.metamind.sendMessage(message);\n  }\n  \n  function replaceLineBreaks(text) {\n    return (text||'').replace(/\\n/g, '<br/>');\n  }\n\n  window.metamind.on('response', function(data) {\n    $('.bot-typing').hide();\n    $('.send-message-btn').removeAttr('disabled');\n    $('.user-text-input').val('');\n    $('.user-text-input').hide();\n    $('.user-date-input').hide();\n    \n    for (var i = 0; i < data.quickResponses.length; i++) {\n      $('.quick-responses').append(`<button class=\"btn btn-info btn-sm quick-message-btn\">${data.quickResponses[i]}</button>`);\n    }\n    \n    const parsedResponse = $('<pre>').html(data.response);\n    const type = parsedResponse.find('input[name=\"metamind-hint-type\"]').val() || 'text';\n    \n    if (type === 'date') {\n      const dateAfterParam = parsedResponse.find('input[name=\"metamind-hint-date-after\"]').val();\n      let dateAfter = null;\n      if (dateAfterParam) {\n        const dateAfterParts = dateAfterParam.split(' ');\n        if (dateAfterParts.length === 3) {       \n          if (dateAfterParts[0] === 'add') {\n            dateAfter = moment().add(dateAfterParts[1], dateAfterParts[2]).toDate();\n          } else if (dateAfterParam[0] === 'subtract') {\n            dateAfter = moment().subtract(dateAfterParts[1], dateAfterParts[2]).toDate();\n          }\n        }\n      }\n\n      const flatpickrInstance = $('.user-date-input')[0]._flatpickr;\n      flatpickrInstance.set('minDate', dateAfter ? dateAfter : null);\n    };\n    \n    switch (type) {\n      case 'text':\n        $('.user-text-input').show();\n      break;\n      case 'date':\n        $('.user-date-input').show();\n      break;\n    }\n\n    $('#botHintText').text(data.hint || '');\n\n    $('.discussion-container').append(\n      `<div class=\"card bot-response\">\n        <div class=\"card-body\">\n          <div class=\"media\">\n           <img class=\"mr-3 user-image\" src=\"${botImage}\">\n           <div class=\"media-body\">\n             <h5 class=\"mt-0\">Lumme Bot</h5>\n             ${data.response}\n           </div>\n          </div>\n        </div>\n      </div>`  \n    );\n    $('.discussion-container')[0].scrollTop = $('.discussion-container')[0].scrollHeight;\n  });\n  \n  $(document).ready(() => {\n    $('.bot-typing').hide();\n    $('.user-date-input').flatpickr({\n      \"locale\": \"fi\",\n      \"dateFormat\": \"d.m.Y\",\n      \"allowInput\": false\n    });\n    \n    $('.send-message-btn').attr('disabled', 'disabled');\n    window.metamind.sendMessage('INIT');\n  });\n  \n  $(document).on('keydown', (event) => {\n    if (event.keyCode === 13) {\n      sendMessage();\n    }\n  });\n  \n})();"]}